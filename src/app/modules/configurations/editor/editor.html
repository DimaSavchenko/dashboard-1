<section horizontal-ui-sheet class="qor-sheet-full">
    <header horizontal-ui-sheet-header title="{{domain.name}} > {{service.service}}">
    </header>
    <div horizontal-ui-sheet-content>
        <div class="editor-content">
            <div class="loading" ng-if="!values">Loading...</div>
            <div class="filled-content" ng-if="values">
                <h3 class="config-table-header">Environment Variables</h3>
                <table class="table table-bordered config-table" ng-hide="values.length == 0">
                    <thead>
                    <tr>
                        <th></th>
                        <th ng-repeat="instance in editorService.instances" class="config-table-th">
                            <h4>{{instance}}</h4>
                            <span dropdown dropdown-append-to-body class="dropdown">
                                <button class="btn config-table-header-button" dropdown-toggle>
                                  {{selectedVersion[instance]}} <span class="label label-success" ng-show="isLive(instance, selectedVersion[instance])">Live</span> <span class="fa fa-chevron-down pull-right"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li ng-repeat="version in editorService.versions">
                                        <a ng-if="changeSelected(instance, version)" ng-hide="isVersionDeleted(instance, version)" ng-click="changeSelectedVersion(instance, version);" ng-class="{'li-active': selectedVersion[instance] == version}">
                                            {{version}}
                                            <span class="label label-success pull-right" ng-show="isLive(instance, version)">Live</span>
                                        </a>
                                    </li>
                                </ul>
                                <span class="fa fa-copy copy-version" ng-click="makeCopy(instance, selectedVersion[instance])"></span>
                                <span class="label label-success set-live-button"
                                      ng-hide="isLive(instance, selectedVersion[instance])"
                                      mwl-confirm
                                      instance="{{instance}}"
                                      title="Are you sure?"
                                      message="Make {{selectedVersion[instance]}} live for {{instance}}"
                                      confirm-text="Yes"
                                      cancel-text="No"
                                      placement="bottom"
                                      on-confirm="makeLive(instance, selectedVersion[instance], $event)">Set live</span>
                            </span>
                        </th>
                        <th class="rox-40px"></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="value in values">
                        <th inline-edit="value.name" is-name="true" on-save="updateName(oldName, newName)">
                            {{value.name}}
                        </th>
                        <th ng-repeat="instance in editorService.instances" parent="value[instance]" key="value.name"
                            versions="editorService.versions"
                            ng-class="{'no-value': !value[instance][selectedVersion[instance]]['value']}"
                            instance="instance" version="selectedVersion[instance]"
                            inline-edit="value[instance][selectedVersion[instance]]['value']"
                            change-selected="changeSelectedVersion"
                            on-delete="deleteValue(name, instance, version)"
                            on-save="updateValues(name, newValue, instance, selectedVersion[instance], xDashVersion)"
                            class="config-input-th"></th>
                        <th><div class="config-table-actions"><span ng-click="deleteInAllVersions(value.name)" class="fa fa-remove config-table-action-btn"> </span></div></th>
                    </tr>
                    </tbody>
                </table>
                <div id="env-loader" ng-show="values.length == 0">
                    <img src="assets/images/cube.gif">
                </div>
            </div>
            <button class="btn btn-warning save-config-button" id="env-save-button" ng-click="save()"
                    ng-show="isSavable()">Save
            </button>
            <button class="btn btn-warning add-config-button" ng-click="addValue()" ng-hide="values.length == 0">Add
                new
            </button>
        </div>
    </div>

    <script type="text/ng-template" id="inlineEdit.html">
        <span  ng-show="isEditAvailable()" ng-click="edit()"
               class="config-table-action-btn fa fa-edit pull-right"></span>
        <textarea rows="1" type="text" on-enter="save()" on-esc="cancel()" ng-model="model" ng-show="editMode"
               class="config-input-edit"></textarea>
        <span ng-click="save()" ng-show="editMode && isSaveAvailable()"
              class="config-table-action-btn fa fa-check pull-right"></span>
        <span class="config-input-span" ng-hide="editMode" ng-click="edit()">{{model}}</span>
        <span  ng-hide="isDeleteUnavailable()" ng-click="delete()"
               class="config-table-action-btn fa fa-remove pull-right"></span>
    </script>

    <script type="text/ng-template" id="newVersionModal.html">
        <div class="modal-header">
            <button type="button" class="close" ng-click="cancel()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Create copy of {{version}} in {{instance}}</h4>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col-md-7">
                    <input type="text" class="form-control" ng-model="newVersionName" placeholder="New version name">
                </div>
                <div class="col-md-1 config-modal-devider">to</div>
                <div class="col-md-4">
                    <select id="select-type" ng-model="targetInstance" class="form-control">
                        <option value="">---Target instance---</option>
                        <option ng-repeat="instance in instances" value="{{instance}}">{{instance}}</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
          <button class="btn btn-primary" id="config-modal-ok-button" type="button" ng-click="ok()">OK</button>
        </div>
    </script>

</section>
